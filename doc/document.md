# Life Game 実装について

二人対戦型ライフゲーム（Conway's Game of Life の改良版）の実装です。

## ゲームルール

1. **盤面**
   - 8×8の二次元配列 `board[y][x]` を使用
   - セル値
     - 0: 死亡セル
     - 1: プレイヤー1が支配する生存セル
     - 2: プレイヤー2が支配する生存セル

2. **フェーズ**
   1. **配置フェーズ**（全16手）
      - P1→P2→P1…と交互に8回ずつセルを配置
      - 範囲外または既に生存セルの場合は違反行為として敗北
   
   2. **シミュレーションフェーズ**（5世代）
      - Conway のライフゲーム規則を5回適用
      - 誕生判定（隣接生存セル数=3）の際、多数派の値を新セルに採用
   
   3. **勝敗判定**
      - 各プレイヤーのセル数を比較し、多い方が勝利
      - 同数の場合は先攻プレイヤー（P1）が勝利

## 通信プロトコル

### 1. 接続フェーズ
```
S → P: "This is a lifegame_py server.  Tell me your name."
P → S: <プレイヤー名>
S → P: {"height": 8, "width": 8}
```

### 2. 配置フェーズ
手番プレイヤー:
```
S → P: "placement"
P → S: {"place": [row, col]}
```

待機プレイヤー:
```
S → P: "waiting"
```

両プレイヤーへの結果通知:
```json
{
  "phase": "placement",
  "board": [[0,0,1,...], ...],
  "next_player": 1
}
```

### 3. シミュレーションフェーズ
```
S → P1,P2: "simulation"
```

結果通知:
```json
{
  "phase": "life_result",
  "board": [[0,2,1,...], ...],
  "count": {"1": 8, "2": 8}
}
```

### 4. 勝敗通知
```
S → 勝者: "you win"
S → 敗者: "you lose"
```

## 実行方法

### ゲームを起動する。（サーバーの起動、クライアントの接続、ゲームの開始）
```bash
make run
```
※ サーバーとPlayer1（P1）の接続はバックグラウンドで行われる。

### Player（P1）を指定して、ゲームを起動する。（Player2はmanual_playerで固定）
```bash
make run P1=[プレイヤー名]
```
※ デフォルトはrandom_playerである。

### ゲームを停止する。
```bash
make stop
```

## 実装の詳細

### ライフゲームの世代更新アルゴリズム
```python
for y,x in 全セル:
    neighbors = 隣接8マスの生存セル
    alive_count = len(neighbors)
    
    if board[y][x] > 0:  # 生存セル
        if 2 <= alive_count <= 3:
            # 生存継続
            new_board[y][x] = board[y][x]
        else:
            # 死亡
            new_board[y][x] = 0
    else:  # 死亡セル
        if alive_count == 3:
            # 誕生（多数派ルール）
            player1_count = neighbors.count(1)
            player2_count = neighbors.count(2)
            if player1_count > player2_count:
                new_board[y][x] = 1
            elif player1_count < player2_count:
                new_board[y][x] = 2
            else:
                new_board[y][x] = 0
```

## サンプル実行例

### 配置フェーズの表示（manual_player）
```
--- Game Phase: Placement ---

Current board (You are Player 1)
+---+---+---+---+---+---+---+---+
|   | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |
+---+---+---+---+---+---+---+---+---+
| 0 | . | . | . | . | . | . | . | . |
+---+---+---+---+---+---+---+---+---+
| 1 | . | 1 | . | . | 2 | . | . | . |
+---+---+---+---+---+---+---+---+---+
| 2 | . | . | . | . | . | . | . | . |
+---+---+---+---+---+---+---+---+---+
| 3 | . | . | . | . | . | . | . | . |
+---+---+---+---+---+---+---+---+---+
| 4 | . | . | . | . | . | . | . | . |
+---+---+---+---+---+---+---+---+---+
| 5 | . | . | . | . | . | . | . | . |
+---+---+---+---+---+---+---+---+---+
```

### 最終結果の表示
```
--- Game Phase: Simulation Result ---

SIMULATION COMPLETE!
Final board state
+---+---+---+---+---+---+---+---+
|   | 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 |
+---+---+---+---+---+---+---+---+---+
| 0 | . | 1 | 1 | . | 2 | 2 | . | . |
+---+---+---+---+---+---+---+---+---+
| 1 | 1 | 1 | 1 | 2 | 2 | 2 | . | . |
+---+---+---+---+---+---+---+---+---+
| 2 | . | 1 | . | . | 2 | . | . | . |
+---+---+---+---+---+---+---+---+---+
| 3 | . | . | . | . | . | . | . | . |
+---+---+---+---+---+---+---+---+---+
| 4 | . | . | . | . | . | . | . | . |
+---+---+---+---+---+---+---+---+---+
| 5 | . | . | . | . | . | . | . | . |
+---+---+---+---+---+---+---+---+---+

Final scores:
Player 1: 6 cells
Player 2: 6 cells

Player 1 wins!
```